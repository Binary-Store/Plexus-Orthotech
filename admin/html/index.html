<!DOCTYPE html>
<html lang="en">
<!-- Begin Head -->

<head>
    <!--=== Required meta tags ===-->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <!--=== custom css ===-->
    <link href="../../assets/fonts/metropolis.css" rel="stylesheet" />
    <link rel="stylesheet" href="../../assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="../../assets/css/animate.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="shortcut icon" type="image/png" href="../../assets/images/favicon.png" />
    <link rel="stylesheet" href="../../assets/css/style.css" />

    <link rel="stylesheet" href="../css/index.css">
    <!--=== custom css ===-->
    <title>Plexus Orthotech - Admin pannel</title>
    <script src="../js/index.js"></script>
    <script>
        //TODO : Add this script to all admin pages once login functionlity compleate
        // document.addEventListener('DOMContentLoaded', function () {
        //     checkCookieAndRedirect('adminToken', './login.html');
        // });
    </script>
</head>

<body>

    <div class="hc-header-wrapper hc-sections">
        <div class=" hc-container">
            <div class="hc-navbar-wrapper">
                <div class="hc-brand-logo">
                    <a href="../../index.html">
                        <img src="../../assets/images/logo.png" class="hc-logo" alt="logo" />
                    </a>
                    <div class="hc-toggle-btn">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
                <div class="hc-navbar-menu">
                    <ul>
                        <li class="responsive-logo">
                            <a href="#">
                                <img src="../../assets/images/logo.png" />
                            </a>
                        </li>
                        <li class="active">
                            <a href="#">Product</a>
                        </li>
                        <li>
                            <a href="./category.html">Category</a>
                        </li>
                        <li>
                            <a href="./careers.html">Careers</a>
                        </li>
                        <li>
                            <a href="./video.html">Video</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="hc-department-wrapper hc-sections pc-container">
        <div class="d-block d-lg-flex justify-content-start gap-3 m-3">
            <div class="input-group input-grop-container mb-3">
                <input type="text" class="form-control">
                <div class="input-group-append"><button class="btn btn-primary"><i class="fas fa-search"></i></button>
                </div>
            </div>
            <!-- Button trigger modal -->
            <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#exampleModal">
                add Product
            </button>
            <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">Add Product</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form class="needs-validation" id="product-form" novalidate>
                                <div class="mb-3 col-12">
                                    <label for="product-name" class="form-label">Product Name</label>
                                    <input type="text" class="form-control" id="product-name" required>
                                    <div class="invalid-feedback">
                                        Please enter a valid product name.
                                    </div>
                                </div>
                                <div class="mb-3 col-12">
                                    <label for="product-category" class="form-label">Category</label>
                                    <select class="form-select border" id="product-category" required>
                                        <option selected disabled value="">Select Category ...</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Please select a Category
                                    </div>
                                </div>
                                <div class="mb-3 col-12">
                                    <label for="product-subcategory" class="form-label">Sub Category</label>
                                    <select class="form-select border" id="product-subcategory" required>
                                        <option selected disabled value="">Choose...</option>
                                        <option>1</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Please select a Sub Category
                                    </div>
                                </div>
                                <div class="mb-3 col-12">
                                    <label for="product-desctiption" class="form-label">Description</label>
                                    <textarea class="form-control" id="product-desctiption" rows="3"></textarea>
                                    <div class="invalid-feedback">
                                        Please enter a valid Description
                                    </div>
                                </div>
                                <div class="mb-3 col-12">
                                    <label for="product-img" class="form-label">Image</label>
                                    <input type="file" class="form-control" id="product-img" required>
                                    <div class="invalid-feedback">
                                        plese upload a image
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">create</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-around flex-wrap" id="product-container">
        </div>
    </div>

    <script src="../../assets/js/jquery.min.js"></script>
    <script src="../../assets/js/bootstrap.min.js"></script>
    <script src="../../assets/js/swiper-bundle.min.js"></script>
    <script src="../../assets/js/custom.js"></script>
    <script>
        let url = 'http://localhost/plexus/admin/includes/product.php'
        let productUrl = 'http://localhost/plexus/admin/images'
        let product = []
        let category = []

        let form = document.getElementById('product-form')

        form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
                event.preventDefault()
                event.stopPropagation()
            }
            // TODO : Add ajax call to save data

            form.classList.add('was-validated')
        })
        $.ajax({
            url: 'http://localhost/plexus/admin/includes/category.php',
            type: 'GET',
            success: function (data) {
                console.log(data, "category")
                category = data.categories
                renderCategory(category)
            },
            error: function (error) {
                console.log(error)
            }
        })

        $.ajax({
            url: url,
            type: 'GET',
            success: function (data) {
                product = data.products
                renderProduct(product)
            },
            error: function (error) {
                console.log(error)
            }
        })

        function renderCategory(category) {
            let product_category = document.getElementById('product-category')
            category.forEach(element => {
                let option = document.createElement('option')
                option.value = element.id
                option.innerText = element.name
                product_category.appendChild(option)
            });
            product_category.addEventListener('change', function () {
                renderSubCategory(this.value); // Render subcategories based on selected category
            });

        }
        function renderSubCategory(id) {

            let product_subcategory = document.getElementById('product-subcategory')
            // Clear previous subcategories
            product_subcategory.innerHTML = '<option selected disabled value="">Choose...</option>'
            let catgoryIndex = category.findIndex(element => element.id == id)
            let subcategory = category[catgoryIndex].subcategories
            subcategory.forEach(element => {
                let option = document.createElement('option')
                option.value = element.id
                option.innerText = element.name
                product_subcategory.appendChild(option)
            });

        }
        function renderProduct(product) {
            let container = document.getElementById("product-container")
            product.forEach(element => {
                let productCard = document.createElement('div')
                productCard.classList.add('product-card')
                productCard.innerHTML = `
                <img src="${productUrl}/${element.image}" alt="Product Image">
                <h3>${element.name}</h3>
                <p>${element.description}</p>
                <p>Category:${element.category}</p>
                <p>Subcategory:${element.subcategory}</p>
                <button class="edit-product-btn" data-id="${element.id}">Edit</button>
                <button class="delete-product-btn" data-id="${element.id}">Delete</button>`
                container.innerHTML = container.innerHTML + productCard.outerHTML;
            });
        }
    </script>

</body>

</html>