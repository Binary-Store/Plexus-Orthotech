<!DOCTYPE html>
<html lang="en">
<!-- Begin Head -->

<head>
  <!--=== Required meta tags ===-->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <!--=== custom css ===-->
  <link href="../../assets/fonts/metropolis.css" rel="stylesheet" />
  <link rel="stylesheet" href="../../assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="../../assets/css/animate.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="shortcut icon" type="image/png" href="../../assets/images/favicon.png" />
  <link rel="stylesheet" href="../../assets/css/style.css" />

  <link rel="stylesheet" href="../css/index.css">
  <!--=== custom css ===-->
  <title>Plexus Orthotech - Admin pannel - career</title>
  <script src="../js/index.js"></script>
  <script>
      // this script redirect to login page if not login 
    document.addEventListener('DOMContentLoaded', function () {
      checkCookieAndRedirect('adminToken', '../index.html');
    });
  </script>
</head>

<body>

  <div class="hc-header-wrapper hc-sections">
    <div class=" hc-container">
      <div class="hc-navbar-wrapper">
        <div class="hc-brand-logo">
          <a href="../../index.html">
            <img src="../../assets/images/logo.png" class="hc-logo" alt="logo" />
          </a>
          <div class="hc-toggle-btn">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
        <div class="hc-navbar-menu">
          <ul>
            <li class="responsive-logo">
              <a href="../../index.html">
                <img src="../../assets/images/logo.png" />
              </a>
            </li>
            <li class="active">
              <a href="./index.html">Product</a>
            </li>
            <li>
              <a href="./category.html">Category</a>
            </li>
            <li>
              <a href="#">Careers</a>
            </li>
            <li>
              <a href="./video.html">Video</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="hc-department-wrapper hc-sections pc-container">
    <div class="table-responsive m-4">
      <table class="table table-hover main-table">
        <thead>
          <tr>
            <th>No</th>
            <th>Name</th>
            <th>Number</th>
            <th>Email</th>
            <th>Resume</th>
            <th>Date</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </div>

  <script src="../../assets/js/jquery.min.js"></script>
  <script src="../../assets/js/bootstrap.min.js"></script>
  <script src="../../assets/js/swiper-bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="../../assets/js/custom.js"></script>
  <script>
    const url = '../includes/career.php'
    let careers = [];
    $.ajax({
      url: url,
      type: 'GET',
      success: function (data) {
        careers = data.careers;
        renderCarrer(careers);
      },
      error: function (error) {
        console.log(error);
      }
    });

    // make renderCarrer function
    function renderCarrer(carrers) {
      const tbody = document.querySelector('.main-table tbody');
      tbody.innerHTML = '';
      carrers.forEach((carrer, index) => {
        let filePath = carrer.resume_path;
        let parts = filePath.split('/');
        let fileName = parts[parts.length - 1];
        let datetime = carrer.created_at;
        let date = datetime.split(' ')[0];
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="align-middle">${index + 1}</td>
          <td class="align-middle">${carrer.name}</td>
          <td class="align-middle">${carrer.contact}</td>
          <td class="align-middle">${carrer.email}</td>
          <td class="align-middle"><a href="../includes/${carrer.resume_path}" target="_blank" alt="">${fileName}</a></td>
          <td class="align-middle">${date}</td>
          <td>
            <div class="action d-flex align-middle justify-content-start gap-4">
              <img src="../../assets/images/admin/delete.svg" onClick="deleteCarrer(${carrer.id})" alt="delete icon">
            </div>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // delete carrer
    function deleteCarrer(id) {
      Swal.fire({
        title: "Are you sure?",
        text: "You won't be able to revert this!",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#3085d6",
        cancelButtonColor: "#d33",
        confirmButtonText: "Yes, delete it!"
      }).then((result) => {
        if (result.isConfirmed) {
          const token = getCookie('adminToken')

          // call delete api 
          $.ajax({
            url: `${url}/${id}`,
            type: "DELETE",
            headers: {
              'Authorization': `Bearer ${token}`,
              'Custom-Header': 'CustomValue'
            },
            success: function (response) {
              careers = careers.filter(carrer => carrer.id != `${id}`)
              renderCarrer(careers)
              Swal.fire({
                title: "Deleted!",
                text: "Your file has been deleted.",
                icon: "success"
              });
            },
            error: function (error) {
              if (error.status === 401) {
              Swal.fire({
                icon: 'error',
                title: 'Unauthorized',
                text: 'Your session has expired, please log in again.',
                confirmButtonText: 'OK'
              }).then((result) => {
                if (result.isConfirmed) {
                  window.location.href = '../index.html'; // Redirect to the login page

                }
              });
            } else {
              Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: error.responseJSON.message
              });
            }
            }
          });
        }
      });
    }
  </script>

</body>

</html>